<!DOCTYPE html>
<html lang="en">
{% load static %}
{% load lessons_extras %}
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Remedial System{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'lessons/css/dashboard.css' %}">
</head>
<body>
        {% if request.GET.print == '1' %}
        <style>
            nav, footer, .logout-btn, .print-btn { display: none !important; }
            .content { margin-top: 0 !important; }
        </style>
        {% endif %}

        <nav>
        <a href="{% url 'website:home' %}" style="display:inline-block; margin-right:12px;">
            <img src="/media/LOGO/school%20badge.jpg" alt="Logo" style="height:32px; vertical-align:middle;">
        </a>
        <button type="button"
                onclick="if (window.history.length > 1) { window.history.back(); } else { window.location.href=&quot;{% url 'website:home' %}&quot;; }"
                style="margin-right:12px; padding:4px 10px; font-size:12px; border-radius:4px; border:1px solid #d1d5db; background:#f9fafb; cursor:pointer;">
            ‚Üê Back
        </button>

        {% if request.user.is_authenticated %}
            {% with current_view=request.resolver_match.url_name %}

                {# ---------------- Teacher (non-staff) navigation ---------------- #}
                {% if not request.user.is_staff %}
                    <a href="{% url 'teacher_dashboard' %}">Dashboard</a>
                    <a href="{% url 'teacher_dashboard' %}?tab=remedial" style="margin-left:12px;">Remedial</a>
                    <a href="{% url 'teacher_normal_stats' %}" style="margin-left:8px;">Normal</a>
                    <a href="{% url 'teacher_normal_timetable' %}"
                       style="margin-left:8px;"
                       class="{% if current_view == 'teacher_normal_timetable' %}nav-active{% endif %}">
                        View Timetable
                    </a>

                {# ---------------- Deputy tools (users in 'Deputy' group) ---------------- #}
                {% elif request.user|has_group:'Deputy' %}
                    <a href="{% url 'teacher_dashboard' %}">Dashboard</a>
                    <a href="{% url 'timetable_builder' %}" style="margin-left:12px;">Timetable Builder</a>
                    <a href="{% url 'generate_week_lessons' %}" style="margin-left:12px;">Generate Week Lessons</a>

                {# ---------------- Superuser remedial admin tools ---------------- #}
                {% elif request.user.is_superuser %}
                    <span style="margin-left:24px; font-weight:bold;">Remedial Admin:</span>
                    <a href="{% url 'remedial_timetable_builder' %}" style="margin-left:8px;">Remedial Builder</a>
                    <a href="{% url 'remedial_timetable_master' %}" style="margin-left:8px;">Remedial Master</a>
                    <a href="{% url 'generate_remedial_week_lessons' %}" style="margin-left:8px;">Generate Remedial Week</a>

                {# ---------------- Other staff (e.g. library) ---------------- #}
                {% else %}
                    <a href="{% url 'library:dashboard' %}">Library</a>
                {% endif %}

            {% endwith %}

            <a href="{% url 'logout' %}" class="logout-btn nav-logout">Logout</a>
        {% else %}
            <a href="{% url 'login' %}">Login</a>
        {% endif %}
    </nav>

    {% if messages %}
      <div style="max-width:1100px; margin:8px auto 0; padding:0 16px;">
        {% for message in messages %}
          <div style="margin-bottom:6px; padding:8px 10px; border-radius:6px; font-size:13px;
                      {% if message.tags == 'error' %}background:#fee2e2;color:#b91c1c;border:1px solid #fecaca;
                      {% elif message.tags == 'success' %}background:#dcfce7;color:#166534;border:1px solid #bbf7d0;
                      {% else %}background:#e5e7eb;color:#111827;border:1px solid #d4d4d8;{% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="content">
        {% block content %}{% endblock %}
    </div>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

</body>
</html>
